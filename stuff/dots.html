<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dots</title>
</head>

<body>
    <style>
        body {
            overflow-x: hidden;
            margin: 0;
            background: #040815;
        }

        canvas {
            position: fixed;
            left: 0;
            top: 0;
        }

        ::-webkit-scrollbar {
            width: 0;
            background-color: transparent;
        }
    </style>
    <canvas></canvas>
    <script>
        const canvas = document.querySelector('canvas')
        const ctx = canvas.getContext('2d')
        const w = document.body.clientWidth
        const h = document.documentElement.clientHeight
        const fps = 30
        let fLimit = 100;
        let force = 3
        const sq = 8
        let mx = my = 0;
        document.body.style.height = (h + 300) + 'px'
        document.body.scrollTo(0, 150)
        canvas.width = w
        canvas.height = h
        let pts = []
        let sources = []
        for (let x = 0; x < w / sq + 1; x++) {
            for (let y = 0; y < h / sq + 1; y++) {
                pts.push({
                    x: sq * x,
                    y: sq * y,
                    opx: sq * x,
                    opy: sq * y,
                    vx: 0,
                    vy: 0
                })
            }
        }
        for (let n = 0; n < 1; n++) {
            sources.push({
                x: Math.random() * w,
                y: Math.random() * h
            })
        }
        ctx.fillStyle = '#fff'
        canvas.onmousemove = function (e) {
            mx = e.clientX
            my = e.clientY
            sources[0] = {
                x: e.clientX,
                y: e.clientY
            }
        }
        window.onscroll = function (e) {
            if (window.pageYOffset > 150) {
                force = Math.max(force - 0.1, -15)
                fLimit = Math.max(fLimit - 3, 0)
            } else {
                force = Math.min(force + 0.1, 15)
                fLimit = Math.min(fLimit + 3, w * 1.5)
            }
            window.scrollTo(0, 150)
        }
        canvas.onclick = function (e) {
            oldForce = force
            oldFLimit = fLimit
            force *= 100
            fLimit *= 100
            console.log(force)
            setTimeout(function () {
                force *= -1
                setTimeout(function () {
                    force = oldForce
                    fLimit = oldFLimit
                }, 1000 / fps)
            }, 3000 / fps)
        }
        setInterval(function () {
            ctx.clearRect(0, 0, w, h)
            pts.forEach(function (pt, v) {
                ptn = pts[v]
                if (Math.sqrt((mx - pt.x) ** 2 + (my - pt.y) ** 2) < fLimit) {
                    let fx = 0;
                    let fy = 0;
                    var fxc = force * (mx - pt.x)
                    var fyc = force * (my - pt.y)
                    fx += fxc
                    fy += fyc
                    let dir = Math.atan2(fy, fx)
                    ptn.vx += 10 * Math.cos(dir)
                    ptn.vy += 10 * Math.sin(dir)

                }
                ptn.vx += -1 * (pt.x - pt.opx) / (fps)
                ptn.vy += -1 * (pt.y - pt.opy) / (fps)
                ptn.vx *= 0.9
                ptn.vy *= 0.9
                ptn.x += ptn.vx / fps
                ptn.y += ptn.vy / fps
                ctx.fillRect(ptn.x, ptn.y, 1, 1)
            })
        }, 1000 / fps)
    </script>
</body>

</html>